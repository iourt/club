angular.module("phoneApp",["ngCordova","ionic","DelegateEvents"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("forum",{"abstract":!0,url:"/forum"}).state("forum.home",{url:"/index.htm",templateUrl:"home/tp/index.html",controller:"tDefault"}).state("forum.start",{url:"/start.htm",templateUrl:"home/tp/start.html",controller:"tStart"}).state("forum.entry",{url:"/entry.htm",templateUrl:"entry/tp/entry.html",controller:"tEntry"}).state("forum.login",{url:"/login.htm",templateUrl:"entry/tp/login.html",controller:"tLogin"}).state("forum.login-forget",{url:"/login/forget.htm",templateUrl:"entry/tp/forget.html",controller:"tLoginForget"}).state("forum.reg-create",{url:"/reg/create.htm",templateUrl:"entry/tp/reg_create.html",controller:"tRegCreate"}).state("forum.reg-account",{url:"/reg/account.htm",templateUrl:"entry/tp/reg_account.html",controller:"tRegAccount"}).state("forum.reg-vcode",{url:"/reg/vcode/:phone",templateUrl:"entry/tp/reg_vcode.html",controller:"tRegVcode"}).state("forum.reg-done",{url:"/reg/done.htm",templateUrl:"entry/tp/reg_done.html",controller:"tRegDone"}).state("forum.reg-column",{url:"/reg/column.htm",templateUrl:"entry/tp/reg_take_column.html",controller:"tRegColumn"}).state("forum.reg-people",{url:"/reg/people.htm",templateUrl:"entry/tp/reg_focus_people.html",controller:"tRegPeople"}).state("forum.find",{url:"/find.htm",templateUrl:"forum/tp/find.html",controller:"tFindIndex"}).state("forum.like",{url:"/like.htm",templateUrl:"forum/tp/like.html",controller:"tFindLike"}).state("forum.photo-edit",{url:"/photo/edit.htm",templateUrl:"forum/tp/photo.html",controller:"tPhotoEdit"}).state("forum.photo-title",{url:"/photo/title.htm?type&club&activity&cate",templateUrl:"forum/tp/photo_title.html",controller:"tPhotoTitle"}).state("forum.photo-cate",{url:"/photo/cate.htm?id",templateUrl:"forum/tp/photo_cate.html",controller:"tPhotoCate"}).state("forum.club-hot",{url:"/club/hot.htm",templateUrl:"forum/tp/club_hot.html",controller:"tClubHot"}).state("forum.club-list",{url:"/club/list.htm",templateUrl:"forum/tp/club_list.html",controller:"tClubList"}).state("forum.club-detail",{url:"/club/detail-{id}.htm",templateUrl:"forum/tp/club_detail.html",controller:"tClubDetail"}).state("forum.club-ranking",{url:"/club/ranking-{id}.htm",templateUrl:"forum/tp/club_ranking.html",controller:"tClubRanking"}).state("forum.activity-list",{url:"/activity/list.htm",templateUrl:"forum/tp/activity_list.html",controller:"tActivityList"}).state("forum.activity-detail",{url:"/activity/detail-{type}-{id}.htm",templateUrl:"forum/tp/activity_detail.html",controller:"tActivityDetail"}).state("forum.subject-list",{url:"/subject/list.htm",templateUrl:"forum/tp/subject_list.html",controller:"tSubjectList"}).state("forum.subject-detail",{url:"/subject/detail-{id}.htm",templateUrl:"forum/tp/subject_detail.html",controller:"tSubjectDetail"}).state("forum.cate",{url:"/cate/list-{id}.htm",templateUrl:"forum/tp/cate_list.html",controller:"tCateList"}).state("forum.detail",{url:"/thread-{id}.htm",templateUrl:"forum/tp/article_detail.html",controller:"tArticleDetail"}).state("forum.report",{url:"/report-{id}.htm?title",templateUrl:"forum/tp/report.html",controller:"tReport"}).state("forum.edit",{url:"/edit-{id}.htm",templateUrl:"forum/tp/article_edit.html",controller:"tEdite"}).state("forum.comment-list",{url:"/comment/list-{id}.htm",templateUrl:"forum/tp/comment_list.html",controller:"tCommentList"}).state("forum.search",{url:"/search/index",templateUrl:"forum/tp/search.html",controller:"tSearchIndex"}).state("forum.search-result",{url:"/search/result?keyword",templateUrl:"forum/tp/search-result.html",controller:"tSearchResult"}).state("forum.chat",{url:"/chat-{uid}.htm?{uname}",templateUrl:"forum/tp/chat.html",controller:"tMsgChat"}).state("forum.msg-index",{url:"/msg/index.htm",templateUrl:"msg/tp/index.html",controller:"tMsgIndex"}).state("forum.msg-notice",{url:"/msg/notice.htm",templateUrl:"msg/tp/notice.html",controller:"tMsgNotice"}).state("forum.msg-comment",{url:"/msg/comment.htm",templateUrl:"msg/tp/comment.html",controller:"tMsgComment"}).state("forum.msg-praise",{url:"/msg/praise.htm",templateUrl:"msg/tp/praise.html",controller:"tMsgPraise"}).state("forum.msg-search",{url:"/msg/search.htm",templateUrl:"msg/tp/search.html",controller:"tMsgSearch"}).state("forum.msg-talk",{url:"/msg/talk.htm",templateUrl:"msg/tp/talk.html",controller:"tMsgTalk"}).state("forum.user-index",{url:"/user/index.htm",templateUrl:"user/tp/index.html",controller:"tUserIndex"}).state("forum.user-other-index",{url:"/user/index-{uid}.htm",templateUrl:"user/tp/user_index.html",controller:"tUserOtherIndex"}).state("forum.user-about",{url:"/user/about.htm",templateUrl:"user/tp/about.html",controller:"tUserAbout"}).state("forum.user-feedback",{url:"/user/feedback.htm",templateUrl:"user/tp/feedback.html",controller:"tUserFeedback"}).state("forum.user-level",{url:"/user/level.htm",templateUrl:"user/tp/level.html",controller:"tUserLevel"}).state("forum.user-cate",{url:"/user/cate.htm",templateUrl:"user/tp/cate-{uid}.html",controller:"tUserCate"}).state("forum.user-article",{url:"/user/article-{uid}.htm",templateUrl:"user/tp/article.html",controller:"tUserArticle"}).state("forum.user-fans",{url:"/user/fans-{uid}.htm",templateUrl:"user/tp/fans.html",controller:"tUserFans"}).state("forum.user-attention",{url:"/user/attention-{uid}.htm",templateUrl:"user/tp/attention.html",controller:"tUserAttention"}).state("forum.user-club",{url:"/user/club-{uid}.htm",templateUrl:"user/tp/club.html",controller:"tUserClub"}).state("forum.userData",{url:"/user/{id}-data.htm",templateUrl:"user/tp/personal_data.html",controller:"userDataCtrl"}).state("forum.user-set",{url:"/user/set.htm",templateUrl:"user/tp/set.html",controller:"tUserSet"}).state("forum.user-set-password",{url:"/user/set/password.htm",templateUrl:"user/tp/set_password.html",controller:"tUserSetPassword"}).state("forum.user-set-bind",{url:"/user/set/bind.htm",templateUrl:"user/tp/set_bind.html",controller:"tUserSetBind"});var n=localStorage.getItem("PHONEAPP_START");e.otherwise("/forum/start.htm")}]),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/city_list.html",'<section class="mod_city_list" ngd-click="toggleCity($event)" selector="dt">\n    <ul>\n        <li ng-click="cancleCity()">取消</li>\n        <li>{{City.tmpName}}</li>\n        <li ng-click="submitCity()">确定</li>\n    </ul>\n\n    <div ngd-click="selectCity($event)" selector="p">\n        <dl ng-repeat="(k, v) in CityList track by $index" ng-class="{open: v.id == City.tmpMid}">\n            <dt data-mid="{{v.id}}" data-mkey="{{k}}" data-name="{{v.name}}">{{v.name}}</dt>\n            <dd>\n                <p ng-repeat="(i, n) in v.sub track by $index" ng-class="{current: n.id == City.tmpSid}" data-sid="{{n.id}}" data-skey="{{k}}" data-name="{{n.name}}">\n                    {{n.name}}\n                </p>\n            </dd>\n        </dl>\n    </div>\n</section>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/footer_bar.html",'<ion-footer-bar>\n    <footer class="mod_footer">\n        <a ng-class="{current : footerTab == 1}" page-jump="none" data-router="forum.home">\n            首页\n        </a>\n        <a ng-class="{current : footerTab == 2}" page-jump="none" data-router="forum.find">\n            发现\n        </a>\n        <p add-photo ng-class="{current : footerTab == 3}"></p>\n        <a ng-class="{current : footerTab==4, new : isMessage}" page-jump="none" data-router="forum.msg-index">\n            消息\n        </a>\n        <a ng-class="{current : footerTab == 5}" page-jump="none" data-router="forum.user-index">\n            我\n        </a>\n    </footer>\n</ion-footer-bar>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/header_bar.html",'<ion-header-bar class="mod_header" ng-class="{transparent:isTransparent}" ng-style="HeaderBg" align-title="center" no-tap-scroll="true">\n	<div class="buttons">\n		<button page-back class="back_button"></button>\n	</div>\n	\n    <h1 class="title" ng-bind-html="Page.Title"></h1>\n\n	<div class="buttons buttons-right" ng-if="Page.RightText">\n		<button class="right_button" ng-click="Page.RightFun()">{{Page.RightText}}</button>\n	</div>\n\n    <!-- <div class="buttons buttons-right" ng-if="Page.Next">\n        <button class="right_button" page-jump data-router="{{Page.SiteUrl.router}}" data-options="{{Page.SiteUrl.options}}">{{Page.Next}}</button>\n    </div> -->\n</ion-header-bar>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/header_opacity.html",'<header class="js_op_header mod_header_opacity">\n    <ul>\n        <li></li>\n        <li>{{Page.Title}}</li>\n        <li></li>\n    </ul>\n    <ul class="js_op_change this_op">\n        <li page-back></li>\n        <li>{{Page.Title}}</li>\n        <li></li>\n    </ul>\n</header>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/job_popup.html",'<div class="choose_job" ngd-click="chooseJob($event)" selector="li">\n	<ul>\n		<li ng-repeat="(k, v) in DataList.JobList track by $index" data-id="{{v.Id}}" data-name="{{v.Name}}" ng-class="{ current : tmpJob == {{v.Id}} }">\n			{{v.Name}}\n		</li>\n	</ul>\n</div>\n\n<!-- <div class="choose_post" ngd-click="chooseJob($event)" selector="li">\n	<ul>\n		<li>\n			<input ng-checked="tmpJob == \'园长\'" name="job" type="radio">\n			<label>园长</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'保教主任\'" name="job" type="radio">\n			<label>保教主任</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'教师\'" name="job" type="radio">\n			<label>教师</label>\n		</li>\n		<li>\n			<input ng-checked="tmpJob == \'其他\'" name="job" type="radio">\n			<label>其他</label>\n		</li>\n	</ul>\n</div> -->')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/location_popup.html",'<div class="choose_location" ngd-click="chooseLocation($event)" selector="li">\n	<ion-scroll class="select_box">\n		<ul data-type="main">\n			<li ng-repeat="(k, v) in CityList track by $index" ng-class="{current: v.id == tmpMid }" data-mid="{{v.id}}" data-mkey="{{k}}">\n				{{v.name}}\n			</li>\n		</ul>\n	</ion-scroll>\n	<ion-scroll class="select_box">\n		<ul data-type="sub">\n			<li ng-repeat="(k, v) in CitySubList track by $index" ng-class="{current: v.id == tmpSid }" data-sid="{{v.id}}" data-skey="{{k}}">\n				{{v.name}}\n			</li>\n		</ul>\n	</ion-scroll>\n</div>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/mod_loading.html",'<ion-spinner icon="ios"></ion-spinner>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/no_network.html",'<div ng-if="noNetwork" class="no-network"> <i class="icon-no-network"></i>\n	网络不给力，刷新页面重试\n	<button ng-click="refreshPage();" class="button button-block button-positive">刷新页面</button>\n</div>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/no_results.html",'<div ng-if="noResults" class="no-results">\n    <i ng-if="hasGlass" class="icon-search"></i>\n    {{noResultsText}}\n</div>\n')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/page_sheet.html",'<section class="mod_sheet" ng-click="hideSheet()">\n    <div>\n        <ul ngd-click="toSheet($event)" selector="li">\n            <li data-type="camera">拍照</li>\n            <li data-type="photo">照片图库</li>\n            <li data-type="close">取消</li>\n        </ul>\n    </div>\n</section>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/search_header.html",'<header class="mod_header_search">\n    <div>\n        <input ng-model="keyword" type="text" value="" placeholder="搜索内容/标签/圈子/用户" />\n        <button ng-click="toSearch()"></button>\n    </div>\n</header>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/user_login.html",'<div class="user_login_pop">\n    <div class="this_cancel" ng-click="closeLogin()">取消</div>\n\n    <dl>\n        <dt></dt>\n        <dd>\n            <ul>\n                <li><input ng-model="tInput.phone" type="tel" placeholder="输入手机号" /></li>\n                <li><input ng-model="tInput.password" type="password" placeholder="输入密码" /></li>\n                <li class="this_login" ng-click="toLogin()">登录</li>\n                <li class="this_link">\n                    <div page-jump data-router="forum.login-forget">找回密码</div>\n                    <p></p>\n                    <div page-jump data-router="forum.reg-create">注册账号</div>\n                </li>\n            </ul>\n        </dd>\n    </dl>\n</div>')}])}(),function(t){try{t=angular.module("phoneApp")}catch(e){t=angular.module("phoneApp",[])}t.run(["$templateCache",function(t){t.put("common/directives/user_login_page.html",'<div class="user_login_page">\n    <div class="this_cancel" page-back>取消</div>\n\n    <dl>\n        <dt></dt>\n        <dd>\n            <ul>\n                <li><input ng-model="tInput.phone" type="tel" placeholder="输入手机号" /></li>\n                <li><input ng-model="tInput.password" type="password" placeholder="输入密码" /></li>\n                <li class="this_login" ng-click="toLogin()">登录</li>\n                <li class="this_link">\n                    <div page-jump data-router="forum.login-forget">找回密码</div>\n                    <p></p>\n                    <div page-jump data-router="forum.reg-create">注册账号</div>\n                </li>\n            </ul>\n        </dd>\n    </dl>\n</div>')}])}(),angular.module("phoneApp").factory("cachePool",function(){var t=function(t){if(!t)return null;var e,n=localStorage.getItem("phoneApp_"+t);try{e=JSON.parse(n)}catch(o){}return e?e:null},e=864e5,n={push:function(n,o,r){if(n&&o){var i=t(n)||{};i.value=o||void 0,i.expired=r?Date.now()+e*r:void 0,localStorage.setItem("phoneApp_"+n,JSON.stringify(i))}},pull:function(e){var n,o=t(e);return!o||o.expired&&o.expired<=Date.now()?null:n=o.value},remove:function(e,n){if(e){var o=t(e);return o?void(n&&o[n]?(o[n]=void 0,localStorage.setItem("phoneApp_"+e,JSON.stringify(o))):localStorage.removeItem("phoneApp_"+e)):void localStorage.removeItem("phoneApp_"+e)}},modify:function(e,n){if(e){var o,r=t(e);if(!r)return void localStorage.removeItem("phoneApp_"+e);if(n){for(o in r.value)n[o]&&(r.value[o]=n[o]);localStorage.setItem("phoneApp_"+e,JSON.stringify(r))}}}};return n}),angular.module("phoneApp").factory("ENV",["$location",function(t){var e=navigator.userAgent.toLowerCase(),n={apiSocket:"http://m.tjoys.net/api/",isHybrid:!1,isWeixin:!1,isApple:!1,isAndroid:!1,appVersion:"1.0.1"};return window.isHybridCreatePhoneApp&&(n.isHybrid=!0),n.isHybrid&&/android/.test(e)&&(n.isAndroid=!0),n.isHybrid&&/iphone|ipad|ipod/.test(e)&&(n.isApple=!0,document.getElementById("js_view").className="is_ios"),/micromessenger/.test(e)&&(n.isWeixin=!0),n}]),angular.module("phoneApp").filter("ellipsis",function(){return function(t,e){return t&&e>0&&t.length>e?t.substring(0,e-2)+"…":t}}),angular.module("phoneApp").filter("specDate",["$filter",function(t){return function(e){var n=Date.now()-e,o="刚刚",r=36e5;return n>24*r?o=t("date")(e,"yyyy/MM/dd"):n>r&&(o=Math.floor(n/r)+"小时前"),o}}]),angular.module("phoneApp").filter("formatScore",function(){return function(t){return 10*Math.floor(t/.5)}}),angular.module("phoneApp").config(["$provide","$httpProvider",function(t,e){t.factory("httpInterceptor",["$q","ENV",function(t,e){var n={request:function(e){e.url;return e||t.when(e)},requestError:function(e){return t.reject(e)},response:function(e){return e||t.when(e)},responseError:function(e){return t.reject(e)}};return n}]),e.interceptors.push("httpInterceptor")}]),angular.module("phoneApp").factory("widget",["$http","$state","$compile","$timeout","$location","$rootScope","$cacheFactory","$ionicLoading","$ionicHistory","$ionicBackdrop","$ionicViewSwitcher","$ionicScrollDelegate","cachePool","ENV","$cordovaKeyboard",function(t,e,n,o,r,i,a,l,c,s,u,p,m,d,h){i.isHybrid=d.isHybrid?!0:!1,document.addEventListener("deviceready",function(){h.hideAccessoryBar(!0)},!1);var g=null,f=a("dataPool"),y={msgToast:function(t,e){var r=angular.element(document.querySelector(".notifier"));if(!r.length){var a=n('<div class="notifier" ng-click="notification=null" ng-show="notification"><span>{{notification}}</span></div>');angular.element(document.getElementsByTagName("body")[0]).append(a(i))}o(function(){i.notification=t},0),o.cancel(g),g=o(function(){i.notification=""},e||2e3)},cacheData:function(t,e){if(!angular.isString(t))return!1;var n=f.get(t);return e?void f.put(t,e):n?n:!1},safeApply:function(t,e){t&&e&&(t.$$phase||t.$root&&t.$root.$$phase?e():t.$apply(e))},stickyTopScroll:function(t,e,n,o){if(t&&n&&n.length&&o&&o.getScrollPosition()){var r,i,a,l,c=o.getScrollPosition().top;if(void 0===t.stickyContent){var s=e('<h2 class="sticker" ng-show="stickyContent != null">{{stickyContent}}</h2>');l=s(t),l.css({position:"absolute",width:"100%"}),angular.element(o.getScrollView().__container).append(l),o.__sticker=l}else l=o.__sticker;for(var u=0,p=n.length;p>u;u++){if(r=n[u],0===u&&(i=r.clientHeight),!(c>=r.offsetTop)){l.hasClass("ng-hide")||(c>=r.offsetTop-i?l.css("top",r.offsetTop-i-c+"px"):l.css("top",0));break}a=r}a&&t.stickyContent!==a.innerHTML?(l.css("top",0),safeApply(t,function(){t.stickyContent=a.innerHTML})):a||safeApply(t,function(){t.stickyContent=null})}},ajaxRequest:function(e){var n=this;if(e){var o={UserId:22,Auth:"asdfasdf",Phone:13596858474,UserName:"测试账号昵称",Sex:1,City:47,CityName:"上海 徐汇区",Job:1,JobName:"园长"};m.push("UserInfo",o,30);var r=e.scope||"",i=e.data||{},a={Header:{UserId:"",Auth:""}},c=m.pull("UserInfo");if(c&&(a.Header.UserId=c.UserId,a.Header.Auth=c.Auth),i=angular.extend({},i,a),e.showPage){if(r.Deploy.isLoading)return;r.Deploy.isLoading=!0,r.Deploy.pageIndex++,angular.extend(i,{PageIndex:r.Deploy.pageIndex,PageSize:r.Deploy.pageSize})}var s={success:function(){},showPage:!1,showLoading:!0,isLogin:!1},u={method:"POST",url:d.apiSocket+e.url||"",data:i,timeout:15e3},p=function(){s.showLoading&&l.hide()};for(var h in e)s[h]=e[h];s.showLoading&&(!s.showPage||s.showPage&&r.Deploy.pageIndex<2)&&l.show({templateUrl:"common/directives/mod_loading.html"}),t(u).success(function(t){t.Response&&"Success"==t.Response.Ack?(r&&(r.Deploy||(r.Deploy={}),t.Response.State||(r.Deploy.isLogin=!1,r.Deploy.uId=0,m.remove("UserInfo"))),"function"==typeof s.success&&s.success(t),e.showPage&&(r.Deploy.isLoading=!1,r.Deploy.pageTotal=t.Total||0,!r.Deploy.pageTotal||r.Deploy.pageTotal&&r.Deploy.pageIndex*r.Deploy.pageSize>=r.Deploy.pageTotal?(r.Deploy.isLoading=!0,r.Deploy.isMore=!1):r.$broadcast("scroll.infiniteScrollComplete"))):n.msgToast("数据请求错误！"),p()}).error(function(t){"function"==typeof s.error?s.error(t):n.msgToast("网络错误，请稍后再试！"),s.showPage&&(r.Deploy.isLoading=!1),p()})}},showStatusBar:function(){function t(){StatusBar.show()}d.isHybrid&&document.addEventListener("deviceready",t,!1)},clearHistory:function(){c.clearHistory()},changeOpacity:function(){var t=p.$getByHandle("mainScroll").getScrollPosition().top,e=0;e=t>30?((t-30)/100).toFixed(1):0,e>1&&(e=1),angular.element(document.querySelector(".js_op_header .js_op_change")).css({opacity:e})},initUser:function(t){var e=m.pull("UserInfo");t.Deploy||(t.Deploy={}),e&&e.UserId?(t.UserInfo=angular.extend({},e),t.Deploy.uId=e.UserId,t.Deploy.isLogin=!0):(t.UserInfo={},t.Deploy.isLogin=!1,t.Deploy.uId=0)},cleanLogin:function(t){t.Deploy.uId=0,t.Deploy.isLogin=!1,m.remove("UserInfo")},modifyLogin:function(t){},checkPhone:function(t){var e=this,n=!1;return t||(e.msgToast("请输入手机号码"),n=!0),/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(t)||(e.msgToast("手机号码格式不合法"),n=!0),n},toBack:function(t){var t=t||-1;return u.nextDirection("back"),c.backView()?void c.goBack(t):void e.go("forum.home")}},v=null;i.$on("$locationChangeStart",function(){angular.element(document.getElementById("shareBtnCtrl")).css("display","none"),v&&(v.close(),v=null)});return y}]),angular.module("phoneApp").directive("appFilereader",["$q","$parse","widget",function(t,e,n){var o=Array.prototype.slice;return{restrict:"A",require:"?ngModel",link:function(e,r,i,a){a&&(a.$render=function(){},r.bind("change",function(r){function i(e){var n=t.defer(),o=new FileReader;return o.onload=function(t){n.resolve(t.target.result)},o.onerror=function(t){n.reject(t)},o.readAsDataURL(e),n.promise}function l(t){var e=angular.element(document.querySelector("#tmp"))[0],n=e.getContext("2d"),o=new Image;o.onload=function(){EXIF.getData(o,function(){var t=EXIF.pretty(this),r=t?t.Orientation:1;n.drawImage(o,0,0);var i=new MegaPixImage(o);i.render(e,{maxWidth:640,orientation:r},function(){var t=e.toDataURL("image/jpeg");a.$setViewValue(t)})})},o.src=t}var c=r.target;t.all(o.call(c.files,0).map(i)).then(function(t){t&&0!=t.length&&(c.multiple?angular.forEach(t,function(t,e){l(t)}):l(t[0]),n.cacheData("CameraImages",e.CameraImages))})}))}}}]).directive("addPhoto",["$state","$parse","$timeout","$compile","$ionicViewSwitcher","widget","ENV",function(t,e,n,o,r,i,a){return{restrict:"A",link:function(e,n,l){n.on("click",function(){if(i.initUser(e),!e.Deploy.isLogin)return void e.showLogin();if(a.isHybrid){var n=o('<section class="js_mod_camera" ngd-click="hideCamera($event)" selector="div"><div class="mod_camera"><ul><li ng-photo>相册</li><li ng-camera>拍照</li></ul></div><section>'),l=document.querySelector(".js_mod_camera");l?l.style.display="block":angular.element(document.querySelector(".pane")).after(n(e)),e.noScroll={"overflow-y":"hidden"}}else r.nextDirection("forward"),t.go("forum.photo-title")}),e.hideCamera=function(t){var n=angular.element(t.delegationTarget);n.parent().css("display","none"),e.noScroll={"overflow-y":"auto"}}}}}]).directive("addImage",["$state","$parse","$timeout","$compile","$ionicActionSheet","$ionicViewSwitcher","widget","ENV",function(t,e,n,o,r,i,a,l){return{restrict:"A",link:function(t,e,n){e.on("click",function(){function e(e){var n=angular.element(document.querySelector("#tmp"))[0],o=n.getContext("2d"),r=new Image;r.onload=function(){EXIF.getData(r,function(){var e=EXIF.pretty(this),i=e?e.Orientation:1;o.drawImage(r,0,0);var a=new MegaPixImage(r);a.render(n,{maxWidth:640,orientation:i},function(){var e=n.toDataURL("image/jpeg");t.Deploy.currentImage=e})})},r.src=e}function n(t){console.log("获取图片失败！")}return a.initUser(t),t.Deploy.isLogin?void r.show({buttons:[{text:"拍照"},{text:"照片图库"}],cancelText:"<b>取消</b>",cancel:function(){},buttonClicked:function(t){function o(){switch(t){case 0:window.navigator.camera.getPicture(e,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA});break;case 1:window.navigator.camera.getPicture(e,n,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})}}return document.addEventListener("deviceready",o,!1),!0}}):void t.showLogin()})}}}]).directive("ngPhoto",["$state","$parse","$timeout","$ionicLoading","$ionicViewSwitcher","widget",function(t,e,n,o,r,i){return{restrict:"A",link:function(e,n,o){function i(e){sessionStorage.setItem("imageData",encodeURIComponent(e)),r.nextDirection("forward"),t.go("forum.photo-title",{type:"other"})}function a(t){console.log("获取图片失败！")}n.on("click",function(){function t(){window.navigator.camera.getPicture(i,a,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})}document.addEventListener("deviceready",t,!1)})}}}]).directive("ngCamera",["$state","$parse","$timeout","$ionicLoading","$ionicViewSwitcher","widget",function(t,e,n,o,r,i){return{restrict:"A",link:function(e,n,o){function a(e){sessionStorage.setItem("imageData",encodeURIComponent(e)),r.nextDirection("forward"),t.go("forum.photo-title",{type:"other"})}function l(t){console.log("获取图片失败！")}n.on("click",function(){function t(){navigator.camera.getPicture(a,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA})}return i.initUser(e),e.Deploy.isLogin?void document.addEventListener("deviceready",t,!1):void e.showLogin()})}}}]),angular.module("phoneApp").directive("checkUser",["$state","$rootScope","cachePool","widget",function(t,e,n,o){return{controller:function(){e.$on("$stateChangeStart",function(t,e,o,r,i){var a=0,l=n.pull("UserInfo")||"";return l&&(a=l.UserId),console.log(a),e.resolve&&e.resolve.isCheck()&&!a?(console.log(1231231),void(window.location.href="/#/entry/login.htm")):void 0})}}}]),angular.module("phoneApp").directive("cityList",["$http","$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(t,e,n,o,r,i,a){return{restrict:"E",replace:!0,templateUrl:"common/directives/city_list.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(e,n,o,r,i,a){e.City||(e.City={}),e.City.tmpName||(e.City.tmpName="选择城市"),t({method:"GET",url:"data/getCityList.json",timeout:15e3}).success(function(t){e.CityList=t}),e.toggleCity=function(t){var n=angular.element(t.delegationTarget);return n.parent("dl").hasClass("open")?void(e.City.tmpMid=0):(e.City.tmpMname=n.attr("data-name"),void(e.City.tmpMid=n.attr("data-mid")))},e.selectCity=function(t){var n=angular.element(t.delegationTarget);e.City.tmpName=e.City.tmpMname+" "+n.attr("data-name"),e.City.tmpSid=n.attr("data-sid"),e.City.tmpCityId=e.City.tmpSid},e.cancleCity=function(t){e.City.tmpMid=0,e.City.tmpSid=0,e.City.tmpCityId=0,e.City.tmpName="选择城市",e.noScroll={"overflow-y":"auto"},e.hideCity()},e.submitCity=function(t){return e.City.tmpCityId?(e.cInput.City=e.City.tmpCityId,e.cInput.CityName=e.City.tmpName,e.Page||(e.Page={}),e.Page.isModify=!0,void e.hideCity()):void a.msgToast("请选择您所在的位置！")},e.showCity=function(){n.css("display","block");e.noScroll={"overflow-y":"hidden"},i(function(){n.addClass("this_show")},50)},e.hideCity=function(){n.removeClass("this_show")},e.choiceCity=function(){return e.CityList&&0!=e.CityList.length?(angular.forEach(e.CityList,function(t,n){angular.forEach(t.sub,function(n,o){n.id==e.cInput.City&&(e.City.tmpMid=t.id,e.City.tmpMname=t.name)})}),e.City.tmpSid=e.cInput.City,e.City.tmpCityId=e.cInput.City,e.City.tmpName=e.cInput.CityName,void e.showCity()):void a.msgToast("网络错误，请稍后再试！")}}]}}]),angular.module("phoneApp").directive("collectionCtrl",["$timeout","Util","DataCachePool",function(t,e,n){return{restrict:"A",link:function(e,o,r){var i=JSON.parse(r.item?r.item:!1);if(i){var a=n.pull("COLLECTION_GOODS")||[],l=-1,c=function(t){return void 0===t?r.index?e.isCollect[r.index]:e.isCollect:void(r.index?e.isCollect[r.index]=t:e.isCollect=t)};t(function(){for(var t=0;t<a.length;t++)if(a[t].InnerId===i.InnerId){l=t,c(!0);break}},0),o.on("click",function(e){if(c())t(function(){c(!1)},100),a.splice(l,1),n.push("COLLECTION_GOODS",a);else{t(function(){c(!0)},100);var o={Id:i.ProductID,InnerId:i.InnerId,Title:i.Name,ImgUrl:i.Picture};a.unshift(o),n.push("COLLECTION_GOODS",a)}})}}}}]),angular.module("phoneApp").directive("contenteditable",function(){return{require:"?ngModel",link:function(t,e,n,o){o&&(e.on("focus",function(t){var e=angular.element(t.target);"备注要求"===e.text()&&e.text("")}),e.on("blur",function(t){var e=angular.element(t.target);""===e.text()&&e.text("备注要求")}),e.on("input",function(){var n=e.html();n=n.replace(/<div>/g,"").replace(/<br>/g,"").replace(/<\/div>/g,""),t.$apply(function(){o.$setViewValue(n),o.$render()})}),e.on("keyup",function(e){return 13===e.keyCode?(console.log(t.remark),!1):void 0}),o.$render=function(){e.html(o.$viewValue)},o.$render())}}}),function(){var t=document.documentElement,e=t.matches||t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector,n=function(t,n){return e?e.call(t,n):t.tagName.toLowerCase()===n},o=function(e,o,r){for(r||(r=t);e&&e!=r&&r.contains(e);){if(n(e,o))return e;e=e.parentNode}return null},r={};t.contains||(Node.prototype.contains=function(t){return!!(16&this.compareDocumentPosition(t))});var i=/^\s*?{.+}\s*?$/;angular.forEach("Event Click Dblclick Mousedown Mouseup Mouseover Mouseout Mousemove Mouseenter Mouseleave".split(" "),function(t){var e="ngd"+t;r[e]=["$parse",function(n){return function(r,a,l){function c(t,e){var i=n(t);a.on(e,function(t){var n,l=t.target;(n=o(l,"string"==typeof s?s:s[e],a[0]))&&(t.delegationTarget=n,i(angular.element(n).scope(),{$event:t,$params:[].slice.call(arguments,1)}),r.$$phase||r.$apply())})}var s=l.selector,u="Event"==t?l.eventName||"click":t.toLowerCase(),p=l[e];s.match(i)&&(s=r.$eval(s)),p.match(i)?(p=r.$eval(p),angular.forEach(p,c)):c(p,u)}}]}),angular.module("DelegateEvents",[]).directive(r)}(),angular.module("phoneApp").directive("falls",["$q","$timeout","$rootScope",function(t,e,n){return{restrict:"E",replace:!0,transclude:!0,template:'<ul class="mod_list_falls ng-transclude"></ul>',controller:["$scope","$element","$attrs",function(o,r,i){n.setFalls=function(n){var o=t.defer(),i=o.promise;e(function(){var t=r;if(n&&(t=angular.element(document.getElementById(n))),0==t.find("li").length)return void o.reject();var e={x:10,y:10},i=(document.body.clientWidth-10)/400;angular.forEach(t.find("li"),function(t,n){angular.element(t).find("img").eq(0).css({height:t.dataset.y*i+"px"});var o=t.offsetHeight;e.x<=e.y?(t.style.cssText="left:0;top:"+e.x+"px",e.x=e.x+10+o):(t.style.cssText="right:0;top:"+e.y+"px",e.y=e.y+10+o)}),e.x<=e.y?t.css("height",e.y+"px"):t.css("height",e.x+"px"),o.resolve(t)},0),i.then(function(t){t.find("li").addClass("active")},function(t){},function(t){})}}]}}]),angular.module("phoneApp").directive("footerBar",["$state","cachePool","ENV",function(t,e,n){var o=0,r=e.pull("UserInfo")||"";return r&&(o=r.UserId),{restrict:"E",replace:!0,templateUrl:"common/directives/footer_bar.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(t,e,n,o,r,i){i.ajaxRequest({scope:t,url:"getMsgNews",data:{},success:function(e){e.Response&&"Success"==e.Response.Ack&&(t.msgStatus={isPraise:e.isPraise,isComment:e.isComment,isNotice:e.isNotice,isTalk:e.isTalk},(e.isPraise||e.isComment||e.isNotice||e.isTalk)&&(t.isMessage=!0))}})}]}}]),angular.module("phoneApp").directive("headerBar",["$window",function(t){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_bar.html",link:function(t,e,n){t.Page||(t.Page={}),t.Page.Title=t.Page.Title||n.title||"",t.Page.RightText=t.Page.RightText||(n.right?n.right.split("|")[0]:""),t.Page.RightFun=t.Page.RightFun||(n.right?t.$eval(n.right.split("|")[1]):"")}}}]).directive("headerOpacity",["$state","$ionicViewSwitcher","$window","cachePool","ENV",function(t,e,n,o,r){return{restrict:"E",replace:!0,templateUrl:"common/directives/header_opacity.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(t,e,n,o,r,i){}]}}]),angular.module("phoneApp").directive("jobPopup",["$http","$ionicPopup","widget","cachePool",function(t,e,n,o){return{restrict:"A",link:function(n,r,i){o.pull("JobData");n.tmpJob=n.cInput.Job,n.chooseJob=function(t){var e=angular.element(t.delegationTarget);e.length>0?(n.tmpJob=e.attr("data-id"),n.tmpJobName=e.attr("data-name")):(n.cInput.Job=n.tmpJob,
n.cInput.JobName=n.tmpJobName)},r.bind("click",function(){t({method:"GET",url:"data/getJobList.json",timeout:15e3}).success(function(t){n.DataList||(n.DataList={}),n.DataList.JobList=t.JobList,e.confirm({title:"选择岗位",cancelText:"取消",cancelType:"cancel",okText:"确定",okType:"confirm",scope:n,templateUrl:"common/directives/job_popup.html"}).then(function(t){t&&(n.chooseJob(!1),n.Page||(n.Page={}),n.Page.isModify=!0)})})})}}}]),angular.module("phoneApp").directive("locationPopup",["$ionicPopup","$http","widget","cachePool",function(t,e,n,o){return{restrict:"A",link:function(o,r,i){o.tmpMid=0,o.tmpSid=0,o.tmpCityId=0,o.chooseLocation=function(t){var e=angular.element(t.delegationTarget),n=e.parent("ul").attr("data-type"),r=e.attr("data-mid"),i=e.attr("data-sid"),a=e.attr("data-mkey"),l=e.attr("data-skey");switch(n){case"main":a=a,l=0,o.tmpCityId=0,o.tmpMid=r;break;case"sub":a=a,l=l,o.tmpSid=i;break;default:return}a&&(o.CitySubList=o.CityList[a].sub),i&&(o.tmpCityId=i)},r.bind("click",function(){e({method:"GET",url:"api/CityData.json",timeout:15e3}).success(function(e){o.CityList=e,o.CitySubList=o.CityList[0].sub,t.confirm({title:"选择位置",cancelText:"取消",cancelType:"cancel",okText:"确定",okType:"confirm",scope:o,templateUrl:"common/directives/location_popup.html"}).then(function(t){if(t){if(!o.tmpCityId)return void alert(1111);angular.forEach(e,function(t){203==t.id&&(find=!0,cityName=t.name),find||angular.forEach(t.sub,function(e){203==e.id&&(cityName=t.name+" "+e.name)})}),o.Page||(o.Page={}),o.Page.isModify=!0}})}).error(function(t){n.msgToast("请检查你的网络！")})})}}}]),angular.module("phoneApp").directive("noNetwork",["$state","$stateParams",function(t,e){return{restrict:"E",templateUrl:"scripts/phoneApp/components/no-network/no-network.html",controller:["$scope",function(n){n.refreshPage=function(){var n=t.current,o=angular.copy(e);t.transitionTo(n,o,{reload:!0,inherit:!0,notify:!0})}}]}}]),angular.module("phoneApp").directive("noResults",["$state","$stateParams",function(t,e){return{restrict:"AE",templateUrl:"scripts/phoneApp/components/no-results/no-results.html",link:function(t,e,n){t.noResultsText=n.text?n.text:"抱歉，查询无结果",n.glass&&(t.hasGlass=!0)}}}]),angular.module("phoneApp").directive("pageSheet",["$state","$window","$timeout","$ionicLoading","$ionicBackdrop","$ionicViewSwitcher","$cordovaActionSheet","cachePool","widget","ENV",function(t,e,n,o,r,i,a,l,c,s){return{restrict:"E",replace:!0,templateUrl:"common/directives/page_sheet.html",controller:["$scope","$element","$rootScope","$compile",function(t,e,o,r){function i(e){t.Deploy.isUpload=!0;var o=angular.element(document.querySelector("#tmp"))[0],r=o.getContext("2d"),i=new Image;i.onload=function(){EXIF.getData(i,function(){var e=EXIF.pretty(this),a=e?e.Orientation:1;r.drawImage(i,0,0);var l=new MegaPixImage(i);l.render(o,{maxWidth:640,orientation:a},function(){var e=o.toDataURL("image/jpeg");n(function(){t.Deploy.isUpload=!1,t.Deploy.currentImage=e},2e3)})})},i.src=e}function l(t){c.msgToast("获取图片失败！")}t.hideSheet=function(){e.addClass("this_hide"),n(function(){e.removeClass("this_show"),e.removeClass("this_hide"),e.css("display","none")},210)},t.showSheet=function(){var t={buttonLabels:["拍照","照片图库"],addCancelButtonWithLabel:"取消",androidEnableCancelButton:!0,winphoneEnableCancelButton:!0};document.addEventListener("deviceready",function(){a.show(t).then(function(t){switch(t){case 1:window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA});break;case 2:window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY})}})},!1)},t.toSheet=function(e){var n=angular.element(e.delegationTarget),o=n.attr("data-type");switch(o){case"photo":window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY});break;case"camera":window.navigator.camera.getPicture(i,l,{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA});break;default:t.hideSheet()}}}]}}]),angular.module("phoneApp").directive("pageBack",["$state","$window","$rootScope","$stateParams","$ionicHistory","$ionicViewSwitcher","widget",function(t,e,n,o,r,i,a){return{restrict:"A",link:function(t,e,n){e.on("click",function(){a.toBack()})}}}]).directive("pageJump",["$window","$state","$rootScope","$stateParams","$ionicHistory","$ionicViewSwitcher",function(t,e,n,o,r,i){return{restrict:"A",link:function(t,n,o){n.on("click",function(n){var a="forward";"none"==o.pageJump&&(a="none",t.loadMore={},r.clearCache(),r.clearHistory());var l=o.router,c=o.options?t.$eval(o.options):{};i.nextDirection(a),e.go(l,c,{inherit:!1})})}}}]),angular.module("phoneApp").directive("searchHeader",["$state","$ionicViewSwitcher","widget","cachePool",function(t,e,n,o){return{restrict:"E",replace:!0,templateUrl:"common/directives/search_header.html",link:function(r,i,a){r.keyword="",r.toSearch=function(){if(r.keyword){var i=o.pull("Keyword")||[];angular.forEach(i,function(t,e){r.keyword==t&&i.splice(e,1)}),i.splice(0,0,r.keyword),o.push("Keyword",i),e.nextDirection("forward"),t.go("forum.search-result",{keyword:encodeURIComponent(r.keyword)})}else t.is("forum.search")?n.msgToast("请输入关键字！"):(e.nextDirection("forward"),t.go("forum.search"))}}}}]),angular.module("phoneApp").directive("shareCtrl",function(){return{restrict:"A",link:function(t,e){e.on("focus blur",function(t){var e=angular.element(t.path[1]);"focus"===t.type?e.addClass("focus"):e.removeClass("focus")})}}}),angular.module("phoneApp").directive("touchMove",["$parse",function(t){return{restrict:"A",compile:function(e,n){var o=t(n.touchMove);return function(t,e){e.on("touchstart",function(e){t.$apply(function(){o(t,{$event:e,$target:e.target})})}),e.on("touchmove",function(e){var n=e.touches[0],r=document.elementFromPoint(n.clientX,n.clientY);t.$apply(function(){o(t,{$event:e,$target:r})}),e.preventDefault()})}}}}]),angular.module("phoneApp").directive("userLogin",["$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(t,e,n,o,r,i){return{restrict:"E",replace:!0,templateUrl:"common/directives/user_login.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(t,e,n,r,i,a){t.tInput={},t.closeLogin=function(){e.removeClass("this_show")},t.showLogin=function(){e.css("display","block");i(function(){e.addClass("this_show")},50)},t.toLogin=function(){return t.tInput.phone?/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(t.tInput.phone)?t.tInput.password?t.tInput.password.length<=5?void a.msgToast("新密码必须大于或等于6位"):void a.ajaxRequest({url:"getLogin",data:{Phone:t.tInput.phone,Password:md5(t.tInput.Password)},success:function(n){n.Response&&n.Response.State?(o.push("UserInfo",{Auth:n.Auth,UserId:n.UserId},2/24),t.Deploy.isLogin=!0):t.Deploy.isLogin=!1,t.closeLogin(),i(function(){e.css("display","none")},300)},error:function(t){}}):void a.msgToast("请输入密码"):void a.msgToast("手机号格式不合法"):void a.msgToast("请输入手机号")}}]}}]).directive("pageLogin",["$state","$ionicViewSwitcher","$window","cachePool","widget","ENV",function(t,e,n,o,r,i){return{restrict:"E",replace:!0,templateUrl:"common/directives/user_login_page.html",controller:["$scope","$element","$rootScope","$compile","$timeout","widget",function(t,e,n,r,i,a){t.tInput={},t.closeLogin=function(){e.removeClass("this_show")},t.showLogin=function(){e.css("display","block");i(function(){e.addClass("this_show")},50)},t.toLogin=function(){return t.tInput.phone?/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(t.tInput.phone)?t.tInput.password?t.tInput.password.length<=5?void a.msgToast("新密码必须大于或等于6位"):void a.ajaxRequest({url:"getLogin",data:{Phone:t.tInput.phone,Password:md5(t.tInput.Password)},success:function(n){n.Response&&n.Response.State?(o.push("UserInfo",{Auth:n.Auth,UserId:n.UserId},2/24),t.Deploy.isLogin=!0):t.Deploy.isLogin=!1,t.closeLogin(),i(function(){e.css("display","none")},300)},error:function(t){}}):void a.msgToast("请输入密码"):void a.msgToast("手机号格式不合法"):void a.msgToast("请输入手机号")}}]}}]),angular.module("phoneApp").directive("getVcode",["$rootScope","$timeout","widget",function(t,e,n){return{restrict:"A",link:function(o,r,i){function a(){t.vEnable=!0,t.vTimer=e(function(){return t.vColdDown--,t.vColdDown<=0?(t.vEnable=!1,void(t.vBtnText="重新发送验证码")):(t.vBtnText="重新发送("+t.vColdDown+")",void a())},1e3)}t.vEnable?(e.cancel(t.vTimer),a()):(t.vColdDown=0,t.vBtnText="发送验证码"),r.bind("click",function(e){var r=n.checkPhone(o.cInput.phone);r||0===t.vColdDown&&(t.vColdDown=60,t.vBtnText="重新发送("+t.vColdDown+")",a(),n.ajaxRequest({url:"setSendPhone",data:{Phone:o.cInput.phone},success:function(t){n.msgToast("验证码已发送到"+o.cInput.phone+"手机上")}}))})}}}]);